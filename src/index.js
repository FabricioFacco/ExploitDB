const { existsSync, readFileSync, writeFileSync } = require("fs")
class exploitdb {
    constructor(arq) {
        if (!arq.endsWith(".json")) throw new Error("[!] O aquivo deve ser json")
        if (!existsSync(arq)) writeFileSync(arq, '{}')
        this.arq = arq
        this.content

        try {
            this.content = JSON.parse(readFileSync(arq))
        } catch (error) {
            throw new Error(`[X] Erro ao carregar a exploitdb\n ${error}`)
        }
    }
    
    exAdd(path, value) {
        if (!path) return this._fds('nome', path)
        if (!value) return this._fds('valor', value)
        if (typeof value !== "number") throw new Error("[!] Value estava esperando: 'number' mas recebeu" + " " + typeof value)
        const valor = this.content[path] || 0
        this.content[path] = valor + value
        writeFileSync(this.arq, JSON.stringify(this.content))
    }

    exSubtract(path, value) {
        if (!path) return this._fds('nome', path)
        if (!value) return this._fds('valor', value)
        if (typeof value !== "number") throw new Error("[!] Value estava esperando: 'number' mas recebeu" + " " + typeof value)
        const valor = this.content[path] || 0
        this.content[path] = valor - value
        writeFileSync(this.arq, JSON.stringify(this.content))
    }

    exSet(path, value) {
        this.content[path] = value
        writeFileSync(this.arq, JSON.stringify(this.content))
    }

    exAll(tipe = 'all') {
        switch (tipe) {
            case 'all': return Object.entries(this.content)
            case 'values': return Object.values(this.content)
            case 'keys': return Object.keys(this.content)
            case 'object': return this.storage
            default: throw new TypeError("[!] Metodo exAll() recebe os tipos: all, values, keys e object, porem, recebeu" + " " + tipe)
        }
    }

    exDelete(path) {
        if (!path) return this._fds('nome', path)
        delete this.content[path]
        writeFileSync(this.arq, JSON.stringify(this.content))
    }

    exGet(path) {
        if (!path) return this._fds('nome', path)
        return this.content[path]
    }

    _fds(op, mt) {
        throw new Error(`[!] Opção ${op} falta metodo ${mt}`)
    }
}

module.exports = exploitdb
